{"dependencies":[{"name":"../../errors/base.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":18,"index":193},"end":{"line":5,"column":49,"index":224}}],"key":"3GwELfaTmapBnCWreQzHgy6p5Bg=","exportNames":["*"],"imports":1}},{"name":"../../errors/calls.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":19,"index":245},"end":{"line":6,"column":51,"index":277}}],"key":"6avS+IEGmBJvbXiv+dBOTuhRCrA=","exportNames":["*"],"imports":1}},{"name":"../../utils/getAction.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":23,"index":302},"end":{"line":7,"column":58,"index":337}}],"key":"d685V9n1u7O1oRJ2ZbnkuLpcslA=","exportNames":["*"],"imports":1}},{"name":"../../utils/observe.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":8,"column":21,"index":360},"end":{"line":8,"column":54,"index":393}}],"key":"NlEDsinWPPoPV3uHdXDCPvBuxx8=","exportNames":["*"],"imports":1}},{"name":"../../utils/poll.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":9,"column":18,"index":413},"end":{"line":9,"column":48,"index":443}}],"key":"VGDCY0JetsesgNJKn2v/Q97mlvo=","exportNames":["*"],"imports":1}},{"name":"../../utils/promise/withResolvers.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":10,"column":27,"index":472},"end":{"line":10,"column":74,"index":519}}],"key":"3cbpFekfDLT4SQOTsAKP0XcZr5g=","exportNames":["*"],"imports":1}},{"name":"../../utils/promise/withRetry.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":11,"column":23,"index":544},"end":{"line":11,"column":66,"index":587}}],"key":"n5f7aA/jyoGNJe/Dppyd5jMg6W0=","exportNames":["*"],"imports":1}},{"name":"../../utils/stringify.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":12,"column":23,"index":612},"end":{"line":12,"column":58,"index":647}}],"key":"o4d2CDgTn514XnsqOYcryKEOe1A=","exportNames":["*"],"imports":1}},{"name":"./getCallsStatus.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":13,"column":28,"index":677},"end":{"line":13,"column":58,"index":707}}],"key":"v17NbPpJzM823nU7ky/xGbkEX8I=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.WaitForCallsStatusTimeoutError = void 0;\n  exports.waitForCallsStatus = waitForCallsStatus;\n  const base_js_1 = require(_dependencyMap[0], \"../../errors/base.js\");\n  const calls_js_1 = require(_dependencyMap[1], \"../../errors/calls.js\");\n  const getAction_js_1 = require(_dependencyMap[2], \"../../utils/getAction.js\");\n  const observe_js_1 = require(_dependencyMap[3], \"../../utils/observe.js\");\n  const poll_js_1 = require(_dependencyMap[4], \"../../utils/poll.js\");\n  const withResolvers_js_1 = require(_dependencyMap[5], \"../../utils/promise/withResolvers.js\");\n  const withRetry_js_1 = require(_dependencyMap[6], \"../../utils/promise/withRetry.js\");\n  const stringify_js_1 = require(_dependencyMap[7], \"../../utils/stringify.js\");\n  const getCallsStatus_js_1 = require(_dependencyMap[8], \"./getCallsStatus.js\");\n  async function waitForCallsStatus(client, parameters) {\n    const {\n      id,\n      pollingInterval = client.pollingInterval,\n      status = ({\n        statusCode\n      }) => statusCode === 200 || statusCode >= 300,\n      retryCount = 4,\n      retryDelay = ({\n        count\n      }) => ~~(1 << count) * 200,\n      timeout = 60_000,\n      throwOnFailure = false\n    } = parameters;\n    const observerId = (0, stringify_js_1.stringify)(['waitForCallsStatus', client.uid, id]);\n    const {\n      promise,\n      resolve,\n      reject\n    } = (0, withResolvers_js_1.withResolvers)();\n    let timer;\n    const unobserve = (0, observe_js_1.observe)(observerId, {\n      resolve,\n      reject\n    }, emit => {\n      const unpoll = (0, poll_js_1.poll)(async () => {\n        const done = fn => {\n          clearTimeout(timer);\n          unpoll();\n          fn();\n          unobserve();\n        };\n        try {\n          const result = await (0, withRetry_js_1.withRetry)(async () => {\n            const result = await (0, getAction_js_1.getAction)(client, getCallsStatus_js_1.getCallsStatus, 'getCallsStatus')({\n              id\n            });\n            if (throwOnFailure && result.status === 'failure') throw new calls_js_1.BundleFailedError(result);\n            return result;\n          }, {\n            retryCount,\n            delay: retryDelay\n          });\n          if (!status(result)) return;\n          done(() => emit.resolve(result));\n        } catch (error) {\n          done(() => emit.reject(error));\n        }\n      }, {\n        interval: pollingInterval,\n        emitOnBegin: true\n      });\n      return unpoll;\n    });\n    timer = timeout ? setTimeout(() => {\n      unobserve();\n      clearTimeout(timer);\n      reject(new WaitForCallsStatusTimeoutError({\n        id\n      }));\n    }, timeout) : undefined;\n    return await promise;\n  }\n  class WaitForCallsStatusTimeoutError extends base_js_1.BaseError {\n    constructor({\n      id\n    }) {\n      super(`Timed out while waiting for call bundle with id \"${id}\" to be confirmed.`, {\n        name: 'WaitForCallsStatusTimeoutError'\n      });\n    }\n  }\n  exports.WaitForCallsStatusTimeoutError = WaitForCallsStatusTimeoutError;\n});","lineCount":91,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"WaitForCallsStatusTimeoutError"],[7,40,3,38],[7,43,3,41],[7,48,3,46],[7,49,3,47],[8,2,4,0,"exports"],[8,9,4,7],[8,10,4,8,"waitForCallsStatus"],[8,28,4,26],[8,31,4,29,"waitForCallsStatus"],[8,49,4,47],[9,2,5,0],[9,8,5,6,"base_js_1"],[9,17,5,15],[9,20,5,18,"require"],[9,27,5,25],[9,28,5,25,"_dependencyMap"],[9,42,5,25],[9,69,5,48],[9,70,5,49],[10,2,6,0],[10,8,6,6,"calls_js_1"],[10,18,6,16],[10,21,6,19,"require"],[10,28,6,26],[10,29,6,26,"_dependencyMap"],[10,43,6,26],[10,71,6,50],[10,72,6,51],[11,2,7,0],[11,8,7,6,"getAction_js_1"],[11,22,7,20],[11,25,7,23,"require"],[11,32,7,30],[11,33,7,30,"_dependencyMap"],[11,47,7,30],[11,78,7,57],[11,79,7,58],[12,2,8,0],[12,8,8,6,"observe_js_1"],[12,20,8,18],[12,23,8,21,"require"],[12,30,8,28],[12,31,8,28,"_dependencyMap"],[12,45,8,28],[12,74,8,53],[12,75,8,54],[13,2,9,0],[13,8,9,6,"poll_js_1"],[13,17,9,15],[13,20,9,18,"require"],[13,27,9,25],[13,28,9,25,"_dependencyMap"],[13,42,9,25],[13,68,9,47],[13,69,9,48],[14,2,10,0],[14,8,10,6,"withResolvers_js_1"],[14,26,10,24],[14,29,10,27,"require"],[14,36,10,34],[14,37,10,34,"_dependencyMap"],[14,51,10,34],[14,94,10,73],[14,95,10,74],[15,2,11,0],[15,8,11,6,"withRetry_js_1"],[15,22,11,20],[15,25,11,23,"require"],[15,32,11,30],[15,33,11,30,"_dependencyMap"],[15,47,11,30],[15,86,11,65],[15,87,11,66],[16,2,12,0],[16,8,12,6,"stringify_js_1"],[16,22,12,20],[16,25,12,23,"require"],[16,32,12,30],[16,33,12,30,"_dependencyMap"],[16,47,12,30],[16,78,12,57],[16,79,12,58],[17,2,13,0],[17,8,13,6,"getCallsStatus_js_1"],[17,27,13,25],[17,30,13,28,"require"],[17,37,13,35],[17,38,13,35,"_dependencyMap"],[17,52,13,35],[17,78,13,57],[17,79,13,58],[18,2,14,0],[18,17,14,15,"waitForCallsStatus"],[18,35,14,33,"waitForCallsStatus"],[18,36,14,34,"client"],[18,42,14,40],[18,44,14,42,"parameters"],[18,54,14,52],[18,56,14,54],[19,4,15,4],[19,10,15,10],[20,6,15,12,"id"],[20,8,15,14],[21,6,15,16,"pollingInterval"],[21,21,15,31],[21,24,15,34,"client"],[21,30,15,40],[21,31,15,41,"pollingInterval"],[21,46,15,56],[22,6,15,58,"status"],[22,12,15,64],[22,15,15,67,"status"],[22,16,15,68],[23,8,15,70,"statusCode"],[24,6,15,81],[24,7,15,82],[24,12,15,87,"statusCode"],[24,22,15,97],[24,27,15,102],[24,30,15,105],[24,34,15,109,"statusCode"],[24,44,15,119],[24,48,15,123],[24,51,15,126],[25,6,15,128,"retryCount"],[25,16,15,138],[25,19,15,141],[25,20,15,142],[26,6,15,144,"retryDelay"],[26,16,15,154],[26,19,15,157,"retryDelay"],[26,20,15,158],[27,8,15,160,"count"],[28,6,15,166],[28,7,15,167],[28,12,15,172],[28,13,15,173],[28,15,15,175],[28,16,15,176],[28,20,15,180,"count"],[28,25,15,185],[28,26,15,186],[28,29,15,189],[28,32,15,192],[29,6,15,194,"timeout"],[29,13,15,201],[29,16,15,204],[29,22,15,210],[30,6,15,212,"throwOnFailure"],[30,20,15,226],[30,23,15,229],[31,4,15,236],[31,5,15,237],[31,8,15,240,"parameters"],[31,18,15,250],[32,4,16,4],[32,10,16,10,"observerId"],[32,20,16,20],[32,23,16,23],[32,24,16,24],[32,25,16,25],[32,27,16,27,"stringify_js_1"],[32,41,16,41],[32,42,16,42,"stringify"],[32,51,16,51],[32,53,16,53],[32,54,16,54],[32,74,16,74],[32,76,16,76,"client"],[32,82,16,82],[32,83,16,83,"uid"],[32,86,16,86],[32,88,16,88,"id"],[32,90,16,90],[32,91,16,91],[32,92,16,92],[33,4,17,4],[33,10,17,10],[34,6,17,12,"promise"],[34,13,17,19],[35,6,17,21,"resolve"],[35,13,17,28],[36,6,17,30,"reject"],[37,4,17,37],[37,5,17,38],[37,8,17,41],[37,9,17,42],[37,10,17,43],[37,12,17,45,"withResolvers_js_1"],[37,30,17,63],[37,31,17,64,"withResolvers"],[37,44,17,77],[37,46,17,79],[37,47,17,80],[38,4,18,4],[38,8,18,8,"timer"],[38,13,18,13],[39,4,19,4],[39,10,19,10,"unobserve"],[39,19,19,19],[39,22,19,22],[39,23,19,23],[39,24,19,24],[39,26,19,26,"observe_js_1"],[39,38,19,38],[39,39,19,39,"observe"],[39,46,19,46],[39,48,19,48,"observerId"],[39,58,19,58],[39,60,19,60],[40,6,19,62,"resolve"],[40,13,19,69],[41,6,19,71,"reject"],[42,4,19,78],[42,5,19,79],[42,7,19,82,"emit"],[42,11,19,86],[42,15,19,91],[43,6,20,8],[43,12,20,14,"unpoll"],[43,18,20,20],[43,21,20,23],[43,22,20,24],[43,23,20,25],[43,25,20,27,"poll_js_1"],[43,34,20,36],[43,35,20,37,"poll"],[43,39,20,41],[43,41,20,43],[43,53,20,55],[44,8,21,12],[44,14,21,18,"done"],[44,18,21,22],[44,21,21,26,"fn"],[44,23,21,28],[44,27,21,33],[45,10,22,16,"clearTimeout"],[45,22,22,28],[45,23,22,29,"timer"],[45,28,22,34],[45,29,22,35],[46,10,23,16,"unpoll"],[46,16,23,22],[46,17,23,23],[46,18,23,24],[47,10,24,16,"fn"],[47,12,24,18],[47,13,24,19],[47,14,24,20],[48,10,25,16,"unobserve"],[48,19,25,25],[48,20,25,26],[48,21,25,27],[49,8,26,12],[49,9,26,13],[50,8,27,12],[50,12,27,16],[51,10,28,16],[51,16,28,22,"result"],[51,22,28,28],[51,25,28,31],[51,31,28,37],[51,32,28,38],[51,33,28,39],[51,35,28,41,"withRetry_js_1"],[51,49,28,55],[51,50,28,56,"withRetry"],[51,59,28,65],[51,61,28,67],[51,73,28,79],[52,12,29,20],[52,18,29,26,"result"],[52,24,29,32],[52,27,29,35],[52,33,29,41],[52,34,29,42],[52,35,29,43],[52,37,29,45,"getAction_js_1"],[52,51,29,59],[52,52,29,60,"getAction"],[52,61,29,69],[52,63,29,71,"client"],[52,69,29,77],[52,71,29,79,"getCallsStatus_js_1"],[52,90,29,98],[52,91,29,99,"getCallsStatus"],[52,105,29,113],[52,107,29,115],[52,123,29,131],[52,124,29,132],[52,125,29,133],[53,14,29,135,"id"],[54,12,29,138],[54,13,29,139],[54,14,29,140],[55,12,30,20],[55,16,30,24,"throwOnFailure"],[55,30,30,38],[55,34,30,42,"result"],[55,40,30,48],[55,41,30,49,"status"],[55,47,30,55],[55,52,30,60],[55,61,30,69],[55,63,31,24],[55,69,31,30],[55,73,31,34,"calls_js_1"],[55,83,31,44],[55,84,31,45,"BundleFailedError"],[55,101,31,62],[55,102,31,63,"result"],[55,108,31,69],[55,109,31,70],[56,12,32,20],[56,19,32,27,"result"],[56,25,32,33],[57,10,33,16],[57,11,33,17],[57,13,33,19],[58,12,34,20,"retryCount"],[58,22,34,30],[59,12,35,20,"delay"],[59,17,35,25],[59,19,35,27,"retryDelay"],[60,10,36,16],[60,11,36,17],[60,12,36,18],[61,10,37,16],[61,14,37,20],[61,15,37,21,"status"],[61,21,37,27],[61,22,37,28,"result"],[61,28,37,34],[61,29,37,35],[61,31,38,20],[62,10,39,16,"done"],[62,14,39,20],[62,15,39,21],[62,21,39,27,"emit"],[62,25,39,31],[62,26,39,32,"resolve"],[62,33,39,39],[62,34,39,40,"result"],[62,40,39,46],[62,41,39,47],[62,42,39,48],[63,8,40,12],[63,9,40,13],[63,10,41,12],[63,17,41,19,"error"],[63,22,41,24],[63,24,41,26],[64,10,42,16,"done"],[64,14,42,20],[64,15,42,21],[64,21,42,27,"emit"],[64,25,42,31],[64,26,42,32,"reject"],[64,32,42,38],[64,33,42,39,"error"],[64,38,42,44],[64,39,42,45],[64,40,42,46],[65,8,43,12],[66,6,44,8],[66,7,44,9],[66,9,44,11],[67,8,45,12,"interval"],[67,16,45,20],[67,18,45,22,"pollingInterval"],[67,33,45,37],[68,8,46,12,"emitOnBegin"],[68,19,46,23],[68,21,46,25],[69,6,47,8],[69,7,47,9],[69,8,47,10],[70,6,48,8],[70,13,48,15,"unpoll"],[70,19,48,21],[71,4,49,4],[71,5,49,5],[71,6,49,6],[72,4,50,4,"timer"],[72,9,50,9],[72,12,50,12,"timeout"],[72,19,50,19],[72,22,51,10,"setTimeout"],[72,32,51,20],[72,33,51,21],[72,39,51,27],[73,6,52,12,"unobserve"],[73,15,52,21],[73,16,52,22],[73,17,52,23],[74,6,53,12,"clearTimeout"],[74,18,53,24],[74,19,53,25,"timer"],[74,24,53,30],[74,25,53,31],[75,6,54,12,"reject"],[75,12,54,18],[75,13,54,19],[75,17,54,23,"WaitForCallsStatusTimeoutError"],[75,47,54,53],[75,48,54,54],[76,8,54,56,"id"],[77,6,54,59],[77,7,54,60],[77,8,54,61],[77,9,54,62],[78,4,55,8],[78,5,55,9],[78,7,55,11,"timeout"],[78,14,55,18],[78,15,55,19],[78,18,56,10,"undefined"],[78,27,56,19],[79,4,57,4],[79,11,57,11],[79,17,57,17,"promise"],[79,24,57,24],[80,2,58,0],[81,2,59,0],[81,8,59,6,"WaitForCallsStatusTimeoutError"],[81,38,59,36],[81,47,59,45,"base_js_1"],[81,56,59,54],[81,57,59,55,"BaseError"],[81,66,59,64],[81,67,59,65],[82,4,60,4,"constructor"],[82,15,60,15,"constructor"],[82,16,60,16],[83,6,60,18,"id"],[84,4,60,21],[84,5,60,22],[84,7,60,24],[85,6,61,8],[85,11,61,13],[85,12,61,14],[85,64,61,66,"id"],[85,66,61,68],[85,86,61,88],[85,88,61,90],[86,8,61,92,"name"],[86,12,61,96],[86,14,61,98],[87,6,61,131],[87,7,61,132],[87,8,61,133],[88,4,62,4],[89,2,63,0],[90,2,64,0,"exports"],[90,9,64,7],[90,10,64,8,"WaitForCallsStatusTimeoutError"],[90,40,64,38],[90,43,64,41,"WaitForCallsStatusTimeoutError"],[90,73,64,71],[91,0,64,72],[91,3]],"functionMap":{"names":["<global>","waitForCallsStatus","<anonymous>","done","done$argument_0","setTimeout$argument_0","WaitForCallsStatusTimeoutError","WaitForCallsStatusTimeoutError#constructor"],"mappings":"AAA;ACa;mECC,2DD,+BC,mCD;iFCI;yBCE;aDK;qBEa,0BF;qBEG,wBF;KDO;qBIE;SJI;CDG;AMC;ICC;KDE;CNC"},"hasCjsExports":true},"type":"js/module"}]}