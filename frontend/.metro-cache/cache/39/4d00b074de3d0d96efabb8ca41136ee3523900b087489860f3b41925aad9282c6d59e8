{"dependencies":[{"name":"../../errors/request.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":21,"index":143},"end":{"line":4,"column":55,"index":177}}],"key":"Bu6PYP3hUl2jiacy+OFL3cCcZHs=","exportNames":["*"],"imports":1}},{"name":"../promise/withTimeout.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":25,"index":204},"end":{"line":5,"column":61,"index":240}}],"key":"5g95l8B8T7AMQE3X+f38j5e0oXU=","exportNames":["*"],"imports":1}},{"name":"../stringify.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":23,"index":265},"end":{"line":6,"column":49,"index":291}}],"key":"c7J+5OC/FhgscMnKu+PvVcdj6nc=","exportNames":["*"],"imports":1}},{"name":"./id.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":16,"index":309},"end":{"line":7,"column":34,"index":327}}],"key":"uUZ2DqYIOswcs+NHxztHkFKEPEc=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.getHttpRpcClient = getHttpRpcClient;\n  const request_js_1 = require(_dependencyMap[0], \"../../errors/request.js\");\n  const withTimeout_js_1 = require(_dependencyMap[1], \"../promise/withTimeout.js\");\n  const stringify_js_1 = require(_dependencyMap[2], \"../stringify.js\");\n  const id_js_1 = require(_dependencyMap[3], \"./id.js\");\n  function getHttpRpcClient(url, options = {}) {\n    return {\n      async request(params) {\n        const {\n          body,\n          fetchFn = options.fetchFn ?? fetch,\n          onRequest = options.onRequest,\n          onResponse = options.onResponse,\n          timeout = options.timeout ?? 10_000\n        } = params;\n        const fetchOptions = {\n          ...(options.fetchOptions ?? {}),\n          ...(params.fetchOptions ?? {})\n        };\n        const {\n          headers,\n          method,\n          signal: signal_\n        } = fetchOptions;\n        try {\n          const response = await (0, withTimeout_js_1.withTimeout)(async ({\n            signal\n          }) => {\n            const init = {\n              ...fetchOptions,\n              body: Array.isArray(body) ? (0, stringify_js_1.stringify)(body.map(body => ({\n                jsonrpc: '2.0',\n                id: body.id ?? id_js_1.idCache.take(),\n                ...body\n              }))) : (0, stringify_js_1.stringify)({\n                jsonrpc: '2.0',\n                id: body.id ?? id_js_1.idCache.take(),\n                ...body\n              }),\n              headers: {\n                'Content-Type': 'application/json',\n                ...headers\n              },\n              method: method || 'POST',\n              signal: signal_ || (timeout > 0 ? signal : null)\n            };\n            const request = new Request(url, init);\n            const args = (await onRequest?.(request, init)) ?? {\n              ...init,\n              url\n            };\n            const response = await fetchFn(args.url ?? url, args);\n            return response;\n          }, {\n            errorInstance: new request_js_1.TimeoutError({\n              body,\n              url\n            }),\n            timeout,\n            signal: true\n          });\n          if (onResponse) await onResponse(response);\n          let data;\n          if (response.headers.get('Content-Type')?.startsWith('application/json')) data = await response.json();else {\n            data = await response.text();\n            try {\n              data = JSON.parse(data || '{}');\n            } catch (err) {\n              if (response.ok) throw err;\n              data = {\n                error: data\n              };\n            }\n          }\n          if (!response.ok) {\n            throw new request_js_1.HttpRequestError({\n              body,\n              details: (0, stringify_js_1.stringify)(data.error) || response.statusText,\n              headers: response.headers,\n              status: response.status,\n              url\n            });\n          }\n          return data;\n        } catch (err) {\n          if (err instanceof request_js_1.HttpRequestError) throw err;\n          if (err instanceof request_js_1.TimeoutError) throw err;\n          throw new request_js_1.HttpRequestError({\n            body,\n            cause: err,\n            url\n          });\n        }\n      }\n    };\n  }\n});","lineCount":103,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"getHttpRpcClient"],[7,26,3,24],[7,29,3,27,"getHttpRpcClient"],[7,45,3,43],[8,2,4,0],[8,8,4,6,"request_js_1"],[8,20,4,18],[8,23,4,21,"require"],[8,30,4,28],[8,31,4,28,"_dependencyMap"],[8,45,4,28],[8,75,4,54],[8,76,4,55],[9,2,5,0],[9,8,5,6,"withTimeout_js_1"],[9,24,5,22],[9,27,5,25,"require"],[9,34,5,32],[9,35,5,32,"_dependencyMap"],[9,49,5,32],[9,81,5,60],[9,82,5,61],[10,2,6,0],[10,8,6,6,"stringify_js_1"],[10,22,6,20],[10,25,6,23,"require"],[10,32,6,30],[10,33,6,30,"_dependencyMap"],[10,47,6,30],[10,69,6,48],[10,70,6,49],[11,2,7,0],[11,8,7,6,"id_js_1"],[11,15,7,13],[11,18,7,16,"require"],[11,25,7,23],[11,26,7,23,"_dependencyMap"],[11,40,7,23],[11,54,7,33],[11,55,7,34],[12,2,8,0],[12,11,8,9,"getHttpRpcClient"],[12,27,8,25,"getHttpRpcClient"],[12,28,8,26,"url"],[12,31,8,29],[12,33,8,31,"options"],[12,40,8,38],[12,43,8,41],[12,44,8,42],[12,45,8,43],[12,47,8,45],[13,4,9,4],[13,11,9,11],[14,6,10,8],[14,12,10,14,"request"],[14,19,10,21,"request"],[14,20,10,22,"params"],[14,26,10,28],[14,28,10,30],[15,8,11,12],[15,14,11,18],[16,10,11,20,"body"],[16,14,11,24],[17,10,11,26,"fetchFn"],[17,17,11,33],[17,20,11,36,"options"],[17,27,11,43],[17,28,11,44,"fetchFn"],[17,35,11,51],[17,39,11,55,"fetch"],[17,44,11,60],[18,10,11,62,"onRequest"],[18,19,11,71],[18,22,11,74,"options"],[18,29,11,81],[18,30,11,82,"onRequest"],[18,39,11,91],[19,10,11,93,"onResponse"],[19,20,11,103],[19,23,11,106,"options"],[19,30,11,113],[19,31,11,114,"onResponse"],[19,41,11,124],[20,10,11,126,"timeout"],[20,17,11,133],[20,20,11,136,"options"],[20,27,11,143],[20,28,11,144,"timeout"],[20,35,11,151],[20,39,11,155],[21,8,11,163],[21,9,11,164],[21,12,11,167,"params"],[21,18,11,173],[22,8,12,12],[22,14,12,18,"fetchOptions"],[22,26,12,30],[22,29,12,33],[23,10,13,16],[23,14,13,20,"options"],[23,21,13,27],[23,22,13,28,"fetchOptions"],[23,34,13,40],[23,38,13,44],[23,39,13,45],[23,40,13,46],[23,41,13,47],[24,10,14,16],[24,14,14,20,"params"],[24,20,14,26],[24,21,14,27,"fetchOptions"],[24,33,14,39],[24,37,14,43],[24,38,14,44],[24,39,14,45],[25,8,15,12],[25,9,15,13],[26,8,16,12],[26,14,16,18],[27,10,16,20,"headers"],[27,17,16,27],[28,10,16,29,"method"],[28,16,16,35],[29,10,16,37,"signal"],[29,16,16,43],[29,18,16,45,"signal_"],[30,8,16,53],[30,9,16,54],[30,12,16,57,"fetchOptions"],[30,24,16,69],[31,8,17,12],[31,12,17,16],[32,10,18,16],[32,16,18,22,"response"],[32,24,18,30],[32,27,18,33],[32,33,18,39],[32,34,18,40],[32,35,18,41],[32,37,18,43,"withTimeout_js_1"],[32,53,18,59],[32,54,18,60,"withTimeout"],[32,65,18,71],[32,67,18,73],[32,74,18,80],[33,12,18,82,"signal"],[34,10,18,89],[34,11,18,90],[34,16,18,95],[35,12,19,20],[35,18,19,26,"init"],[35,22,19,30],[35,25,19,33],[36,14,20,24],[36,17,20,27,"fetchOptions"],[36,29,20,39],[37,14,21,24,"body"],[37,18,21,28],[37,20,21,30,"Array"],[37,25,21,35],[37,26,21,36,"isArray"],[37,33,21,43],[37,34,21,44,"body"],[37,38,21,48],[37,39,21,49],[37,42,22,30],[37,43,22,31],[37,44,22,32],[37,46,22,34,"stringify_js_1"],[37,60,22,48],[37,61,22,49,"stringify"],[37,70,22,58],[37,72,22,60,"body"],[37,76,22,64],[37,77,22,65,"map"],[37,80,22,68],[37,81,22,70,"body"],[37,85,22,74],[37,90,22,80],[38,16,23,32,"jsonrpc"],[38,23,23,39],[38,25,23,41],[38,30,23,46],[39,16,24,32,"id"],[39,18,24,34],[39,20,24,36,"body"],[39,24,24,40],[39,25,24,41,"id"],[39,27,24,43],[39,31,24,47,"id_js_1"],[39,38,24,54],[39,39,24,55,"idCache"],[39,46,24,62],[39,47,24,63,"take"],[39,51,24,67],[39,52,24,68],[39,53,24,69],[40,16,25,32],[40,19,25,35,"body"],[41,14,26,28],[41,15,26,29],[41,16,26,30],[41,17,26,31],[41,18,26,32],[41,21,27,30],[41,22,27,31],[41,23,27,32],[41,25,27,34,"stringify_js_1"],[41,39,27,48],[41,40,27,49,"stringify"],[41,49,27,58],[41,51,27,60],[42,16,28,32,"jsonrpc"],[42,23,28,39],[42,25,28,41],[42,30,28,46],[43,16,29,32,"id"],[43,18,29,34],[43,20,29,36,"body"],[43,24,29,40],[43,25,29,41,"id"],[43,27,29,43],[43,31,29,47,"id_js_1"],[43,38,29,54],[43,39,29,55,"idCache"],[43,46,29,62],[43,47,29,63,"take"],[43,51,29,67],[43,52,29,68],[43,53,29,69],[44,16,30,32],[44,19,30,35,"body"],[45,14,31,28],[45,15,31,29],[45,16,31,30],[46,14,32,24,"headers"],[46,21,32,31],[46,23,32,33],[47,16,33,28],[47,30,33,42],[47,32,33,44],[47,50,33,62],[48,16,34,28],[48,19,34,31,"headers"],[49,14,35,24],[49,15,35,25],[50,14,36,24,"method"],[50,20,36,30],[50,22,36,32,"method"],[50,28,36,38],[50,32,36,42],[50,38,36,48],[51,14,37,24,"signal"],[51,20,37,30],[51,22,37,32,"signal_"],[51,29,37,39],[51,34,37,44,"timeout"],[51,41,37,51],[51,44,37,54],[51,45,37,55],[51,48,37,58,"signal"],[51,54,37,64],[51,57,37,67],[51,61,37,71],[52,12,38,20],[52,13,38,21],[53,12,39,20],[53,18,39,26,"request"],[53,25,39,33],[53,28,39,36],[53,32,39,40,"Request"],[53,39,39,47],[53,40,39,48,"url"],[53,43,39,51],[53,45,39,53,"init"],[53,49,39,57],[53,50,39,58],[54,12,40,20],[54,18,40,26,"args"],[54,22,40,30],[54,25,40,33],[54,26,40,34],[54,32,40,40,"onRequest"],[54,41,40,49],[54,44,40,52,"request"],[54,51,40,59],[54,53,40,61,"init"],[54,57,40,65],[54,58,40,66],[54,63,40,71],[55,14,40,73],[55,17,40,76,"init"],[55,21,40,80],[56,14,40,82,"url"],[57,12,40,86],[57,13,40,87],[58,12,41,20],[58,18,41,26,"response"],[58,26,41,34],[58,29,41,37],[58,35,41,43,"fetchFn"],[58,42,41,50],[58,43,41,51,"args"],[58,47,41,55],[58,48,41,56,"url"],[58,51,41,59],[58,55,41,63,"url"],[58,58,41,66],[58,60,41,68,"args"],[58,64,41,72],[58,65,41,73],[59,12,42,20],[59,19,42,27,"response"],[59,27,42,35],[60,10,43,16],[60,11,43,17],[60,13,43,19],[61,12,44,20,"errorInstance"],[61,25,44,33],[61,27,44,35],[61,31,44,39,"request_js_1"],[61,43,44,51],[61,44,44,52,"TimeoutError"],[61,56,44,64],[61,57,44,65],[62,14,44,67,"body"],[62,18,44,71],[63,14,44,73,"url"],[64,12,44,77],[64,13,44,78],[64,14,44,79],[65,12,45,20,"timeout"],[65,19,45,27],[66,12,46,20,"signal"],[66,18,46,26],[66,20,46,28],[67,10,47,16],[67,11,47,17],[67,12,47,18],[68,10,48,16],[68,14,48,20,"onResponse"],[68,24,48,30],[68,26,49,20],[68,32,49,26,"onResponse"],[68,42,49,36],[68,43,49,37,"response"],[68,51,49,45],[68,52,49,46],[69,10,50,16],[69,14,50,20,"data"],[69,18,50,24],[70,10,51,16],[70,14,51,20,"response"],[70,22,51,28],[70,23,51,29,"headers"],[70,30,51,36],[70,31,51,37,"get"],[70,34,51,40],[70,35,51,41],[70,49,51,55],[70,50,51,56],[70,52,51,58,"startsWith"],[70,62,51,68],[70,63,51,69],[70,81,51,87],[70,82,51,88],[70,84,52,20,"data"],[70,88,52,24],[70,91,52,27],[70,97,52,33,"response"],[70,105,52,41],[70,106,52,42,"json"],[70,110,52,46],[70,111,52,47],[70,112,52,48],[70,113,52,49],[70,118,53,21],[71,12,54,20,"data"],[71,16,54,24],[71,19,54,27],[71,25,54,33,"response"],[71,33,54,41],[71,34,54,42,"text"],[71,38,54,46],[71,39,54,47],[71,40,54,48],[72,12,55,20],[72,16,55,24],[73,14,56,24,"data"],[73,18,56,28],[73,21,56,31,"JSON"],[73,25,56,35],[73,26,56,36,"parse"],[73,31,56,41],[73,32,56,42,"data"],[73,36,56,46],[73,40,56,50],[73,44,56,54],[73,45,56,55],[74,12,57,20],[74,13,57,21],[74,14,58,20],[74,21,58,27,"err"],[74,24,58,30],[74,26,58,32],[75,14,59,24],[75,18,59,28,"response"],[75,26,59,36],[75,27,59,37,"ok"],[75,29,59,39],[75,31,60,28],[75,37,60,34,"err"],[75,40,60,37],[76,14,61,24,"data"],[76,18,61,28],[76,21,61,31],[77,16,61,33,"error"],[77,21,61,38],[77,23,61,40,"data"],[78,14,61,45],[78,15,61,46],[79,12,62,20],[80,10,63,16],[81,10,64,16],[81,14,64,20],[81,15,64,21,"response"],[81,23,64,29],[81,24,64,30,"ok"],[81,26,64,32],[81,28,64,34],[82,12,65,20],[82,18,65,26],[82,22,65,30,"request_js_1"],[82,34,65,42],[82,35,65,43,"HttpRequestError"],[82,51,65,59],[82,52,65,60],[83,14,66,24,"body"],[83,18,66,28],[84,14,67,24,"details"],[84,21,67,31],[84,23,67,33],[84,24,67,34],[84,25,67,35],[84,27,67,37,"stringify_js_1"],[84,41,67,51],[84,42,67,52,"stringify"],[84,51,67,61],[84,53,67,63,"data"],[84,57,67,67],[84,58,67,68,"error"],[84,63,67,73],[84,64,67,74],[84,68,67,78,"response"],[84,76,67,86],[84,77,67,87,"statusText"],[84,87,67,97],[85,14,68,24,"headers"],[85,21,68,31],[85,23,68,33,"response"],[85,31,68,41],[85,32,68,42,"headers"],[85,39,68,49],[86,14,69,24,"status"],[86,20,69,30],[86,22,69,32,"response"],[86,30,69,40],[86,31,69,41,"status"],[86,37,69,47],[87,14,70,24,"url"],[88,12,71,20],[88,13,71,21],[88,14,71,22],[89,10,72,16],[90,10,73,16],[90,17,73,23,"data"],[90,21,73,27],[91,8,74,12],[91,9,74,13],[91,10,75,12],[91,17,75,19,"err"],[91,20,75,22],[91,22,75,24],[92,10,76,16],[92,14,76,20,"err"],[92,17,76,23],[92,29,76,35,"request_js_1"],[92,41,76,47],[92,42,76,48,"HttpRequestError"],[92,58,76,64],[92,60,77,20],[92,66,77,26,"err"],[92,69,77,29],[93,10,78,16],[93,14,78,20,"err"],[93,17,78,23],[93,29,78,35,"request_js_1"],[93,41,78,47],[93,42,78,48,"TimeoutError"],[93,54,78,60],[93,56,79,20],[93,62,79,26,"err"],[93,65,79,29],[94,10,80,16],[94,16,80,22],[94,20,80,26,"request_js_1"],[94,32,80,38],[94,33,80,39,"HttpRequestError"],[94,49,80,55],[94,50,80,56],[95,12,81,20,"body"],[95,16,81,24],[96,12,82,20,"cause"],[96,17,82,25],[96,19,82,27,"err"],[96,22,82,30],[97,12,83,20,"url"],[98,10,84,16],[98,11,84,17],[98,12,84,18],[99,8,85,12],[100,6,86,8],[101,4,87,4],[101,5,87,5],[102,2,88,0],[103,0,88,1],[103,3]],"functionMap":{"names":["<global>","getHttpRpcClient","request","<anonymous>","body.map$argument_0"],"mappings":"AAA;ACO;QCE;yECQ;qECI;8BDI;iBDiB;SD2C;CDE"},"hasCjsExports":true},"type":"js/module"}]}