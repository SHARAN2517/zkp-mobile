{"dependencies":[{"name":"../../errors/request.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":21,"index":153},"end":{"line":4,"column":55,"index":187}}],"key":"Bu6PYP3hUl2jiacy+OFL3cCcZHs=","exportNames":["*"],"imports":1}},{"name":"./socket.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":20,"index":209},"end":{"line":5,"column":42,"index":231}}],"key":"mIp26Y4RZBmjLnn6eJPUMQuqDuA=","exportNames":["*"],"imports":1}},{"name":"isows","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":10,"column":65,"index":519},"end":{"line":10,"column":81,"index":535}}],"key":"jQDboCV7KGBj8OKLH0IUEzqRis4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.getWebSocketRpcClient = getWebSocketRpcClient;\n  const request_js_1 = require(_dependencyMap[0], \"../../errors/request.js\");\n  const socket_js_1 = require(_dependencyMap[1], \"./socket.js\");\n  async function getWebSocketRpcClient(url, options = {}) {\n    const {\n      keepAlive,\n      reconnect\n    } = options;\n    return (0, socket_js_1.getSocketRpcClient)({\n      async getSocket({\n        onClose,\n        onError,\n        onOpen,\n        onResponse\n      }) {\n        const WebSocket = await Promise.resolve().then(() => require(_dependencyMap[2], \"isows\")).then(module => module.WebSocket);\n        const socket = new WebSocket(url);\n        function onClose_() {\n          socket.removeEventListener('close', onClose_);\n          socket.removeEventListener('message', onMessage);\n          socket.removeEventListener('error', onError);\n          socket.removeEventListener('open', onOpen);\n          onClose();\n        }\n        function onMessage({\n          data\n        }) {\n          if (typeof data === 'string' && data.trim().length === 0) return;\n          try {\n            const _data = JSON.parse(data);\n            onResponse(_data);\n          } catch (error) {\n            onError(error);\n          }\n        }\n        socket.addEventListener('close', onClose_);\n        socket.addEventListener('message', onMessage);\n        socket.addEventListener('error', onError);\n        socket.addEventListener('open', onOpen);\n        if (socket.readyState === WebSocket.CONNECTING) {\n          await new Promise((resolve, reject) => {\n            if (!socket) return;\n            socket.onopen = resolve;\n            socket.onerror = reject;\n          });\n        }\n        const {\n          close: close_\n        } = socket;\n        return Object.assign(socket, {\n          close() {\n            close_.bind(socket)();\n            onClose_();\n          },\n          ping() {\n            try {\n              if (socket.readyState === socket.CLOSED || socket.readyState === socket.CLOSING) throw new request_js_1.WebSocketRequestError({\n                url: socket.url,\n                cause: new request_js_1.SocketClosedError({\n                  url: socket.url\n                })\n              });\n              const body = {\n                jsonrpc: '2.0',\n                id: null,\n                method: 'net_version',\n                params: []\n              };\n              socket.send(JSON.stringify(body));\n            } catch (error) {\n              onError(error);\n            }\n          },\n          request({\n            body\n          }) {\n            if (socket.readyState === socket.CLOSED || socket.readyState === socket.CLOSING) throw new request_js_1.WebSocketRequestError({\n              body,\n              url: socket.url,\n              cause: new request_js_1.SocketClosedError({\n                url: socket.url\n              })\n            });\n            return socket.send(JSON.stringify(body));\n          }\n        });\n      },\n      keepAlive,\n      reconnect,\n      url\n    });\n  }\n});","lineCount":99,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"getWebSocketRpcClient"],[7,31,3,29],[7,34,3,32,"getWebSocketRpcClient"],[7,55,3,53],[8,2,4,0],[8,8,4,6,"request_js_1"],[8,20,4,18],[8,23,4,21,"require"],[8,30,4,28],[8,31,4,28,"_dependencyMap"],[8,45,4,28],[8,75,4,54],[8,76,4,55],[9,2,5,0],[9,8,5,6,"socket_js_1"],[9,19,5,17],[9,22,5,20,"require"],[9,29,5,27],[9,30,5,27,"_dependencyMap"],[9,44,5,27],[9,62,5,41],[9,63,5,42],[10,2,6,0],[10,17,6,15,"getWebSocketRpcClient"],[10,38,6,36,"getWebSocketRpcClient"],[10,39,6,37,"url"],[10,42,6,40],[10,44,6,42,"options"],[10,51,6,49],[10,54,6,52],[10,55,6,53],[10,56,6,54],[10,58,6,56],[11,4,7,4],[11,10,7,10],[12,6,7,12,"keepAlive"],[12,15,7,21],[13,6,7,23,"reconnect"],[14,4,7,33],[14,5,7,34],[14,8,7,37,"options"],[14,15,7,44],[15,4,8,4],[15,11,8,11],[15,12,8,12],[15,13,8,13],[15,15,8,15,"socket_js_1"],[15,26,8,26],[15,27,8,27,"getSocketRpcClient"],[15,45,8,45],[15,47,8,47],[16,6,9,8],[16,12,9,14,"getSocket"],[16,21,9,23,"getSocket"],[16,22,9,24],[17,8,9,26,"onClose"],[17,15,9,33],[18,8,9,35,"onError"],[18,15,9,42],[19,8,9,44,"onOpen"],[19,14,9,50],[20,8,9,52,"onResponse"],[21,6,9,63],[21,7,9,64],[21,9,9,66],[22,8,10,12],[22,14,10,18,"WebSocket"],[22,23,10,27],[22,26,10,30],[22,32,10,36,"Promise"],[22,39,10,43],[22,40,10,44,"resolve"],[22,47,10,51],[22,48,10,52],[22,49,10,53],[22,50,10,54,"then"],[22,54,10,58],[22,55,10,59],[22,61,10,65,"require"],[22,68,10,72],[22,69,10,72,"_dependencyMap"],[22,83,10,72],[22,95,10,80],[22,96,10,81],[22,97,10,82],[22,98,10,83,"then"],[22,102,10,87],[22,103,10,89,"module"],[22,109,10,95],[22,113,10,100,"module"],[22,119,10,106],[22,120,10,107,"WebSocket"],[22,129,10,116],[22,130,10,117],[23,8,11,12],[23,14,11,18,"socket"],[23,20,11,24],[23,23,11,27],[23,27,11,31,"WebSocket"],[23,36,11,40],[23,37,11,41,"url"],[23,40,11,44],[23,41,11,45],[24,8,12,12],[24,17,12,21,"onClose_"],[24,25,12,29,"onClose_"],[24,26,12,29],[24,28,12,32],[25,10,13,16,"socket"],[25,16,13,22],[25,17,13,23,"removeEventListener"],[25,36,13,42],[25,37,13,43],[25,44,13,50],[25,46,13,52,"onClose_"],[25,54,13,60],[25,55,13,61],[26,10,14,16,"socket"],[26,16,14,22],[26,17,14,23,"removeEventListener"],[26,36,14,42],[26,37,14,43],[26,46,14,52],[26,48,14,54,"onMessage"],[26,57,14,63],[26,58,14,64],[27,10,15,16,"socket"],[27,16,15,22],[27,17,15,23,"removeEventListener"],[27,36,15,42],[27,37,15,43],[27,44,15,50],[27,46,15,52,"onError"],[27,53,15,59],[27,54,15,60],[28,10,16,16,"socket"],[28,16,16,22],[28,17,16,23,"removeEventListener"],[28,36,16,42],[28,37,16,43],[28,43,16,49],[28,45,16,51,"onOpen"],[28,51,16,57],[28,52,16,58],[29,10,17,16,"onClose"],[29,17,17,23],[29,18,17,24],[29,19,17,25],[30,8,18,12],[31,8,19,12],[31,17,19,21,"onMessage"],[31,26,19,30,"onMessage"],[31,27,19,31],[32,10,19,33,"data"],[33,8,19,38],[33,9,19,39],[33,11,19,41],[34,10,20,16],[34,14,20,20],[34,21,20,27,"data"],[34,25,20,31],[34,30,20,36],[34,38,20,44],[34,42,20,48,"data"],[34,46,20,52],[34,47,20,53,"trim"],[34,51,20,57],[34,52,20,58],[34,53,20,59],[34,54,20,60,"length"],[34,60,20,66],[34,65,20,71],[34,66,20,72],[34,68,21,20],[35,10,22,16],[35,14,22,20],[36,12,23,20],[36,18,23,26,"_data"],[36,23,23,31],[36,26,23,34,"JSON"],[36,30,23,38],[36,31,23,39,"parse"],[36,36,23,44],[36,37,23,45,"data"],[36,41,23,49],[36,42,23,50],[37,12,24,20,"onResponse"],[37,22,24,30],[37,23,24,31,"_data"],[37,28,24,36],[37,29,24,37],[38,10,25,16],[38,11,25,17],[38,12,26,16],[38,19,26,23,"error"],[38,24,26,28],[38,26,26,30],[39,12,27,20,"onError"],[39,19,27,27],[39,20,27,28,"error"],[39,25,27,33],[39,26,27,34],[40,10,28,16],[41,8,29,12],[42,8,30,12,"socket"],[42,14,30,18],[42,15,30,19,"addEventListener"],[42,31,30,35],[42,32,30,36],[42,39,30,43],[42,41,30,45,"onClose_"],[42,49,30,53],[42,50,30,54],[43,8,31,12,"socket"],[43,14,31,18],[43,15,31,19,"addEventListener"],[43,31,31,35],[43,32,31,36],[43,41,31,45],[43,43,31,47,"onMessage"],[43,52,31,56],[43,53,31,57],[44,8,32,12,"socket"],[44,14,32,18],[44,15,32,19,"addEventListener"],[44,31,32,35],[44,32,32,36],[44,39,32,43],[44,41,32,45,"onError"],[44,48,32,52],[44,49,32,53],[45,8,33,12,"socket"],[45,14,33,18],[45,15,33,19,"addEventListener"],[45,31,33,35],[45,32,33,36],[45,38,33,42],[45,40,33,44,"onOpen"],[45,46,33,50],[45,47,33,51],[46,8,34,12],[46,12,34,16,"socket"],[46,18,34,22],[46,19,34,23,"readyState"],[46,29,34,33],[46,34,34,38,"WebSocket"],[46,43,34,47],[46,44,34,48,"CONNECTING"],[46,54,34,58],[46,56,34,60],[47,10,35,16],[47,16,35,22],[47,20,35,26,"Promise"],[47,27,35,33],[47,28,35,34],[47,29,35,35,"resolve"],[47,36,35,42],[47,38,35,44,"reject"],[47,44,35,50],[47,49,35,55],[48,12,36,20],[48,16,36,24],[48,17,36,25,"socket"],[48,23,36,31],[48,25,37,24],[49,12,38,20,"socket"],[49,18,38,26],[49,19,38,27,"onopen"],[49,25,38,33],[49,28,38,36,"resolve"],[49,35,38,43],[50,12,39,20,"socket"],[50,18,39,26],[50,19,39,27,"onerror"],[50,26,39,34],[50,29,39,37,"reject"],[50,35,39,43],[51,10,40,16],[51,11,40,17],[51,12,40,18],[52,8,41,12],[53,8,42,12],[53,14,42,18],[54,10,42,20,"close"],[54,15,42,25],[54,17,42,27,"close_"],[55,8,42,34],[55,9,42,35],[55,12,42,38,"socket"],[55,18,42,44],[56,8,43,12],[56,15,43,19,"Object"],[56,21,43,25],[56,22,43,26,"assign"],[56,28,43,32],[56,29,43,33,"socket"],[56,35,43,39],[56,37,43,41],[57,10,44,16,"close"],[57,15,44,21,"close"],[57,16,44,21],[57,18,44,24],[58,12,45,20,"close_"],[58,18,45,26],[58,19,45,27,"bind"],[58,23,45,31],[58,24,45,32,"socket"],[58,30,45,38],[58,31,45,39],[58,32,45,40],[58,33,45,41],[59,12,46,20,"onClose_"],[59,20,46,28],[59,21,46,29],[59,22,46,30],[60,10,47,16],[60,11,47,17],[61,10,48,16,"ping"],[61,14,48,20,"ping"],[61,15,48,20],[61,17,48,23],[62,12,49,20],[62,16,49,24],[63,14,50,24],[63,18,50,28,"socket"],[63,24,50,34],[63,25,50,35,"readyState"],[63,35,50,45],[63,40,50,50,"socket"],[63,46,50,56],[63,47,50,57,"CLOSED"],[63,53,50,63],[63,57,51,28,"socket"],[63,63,51,34],[63,64,51,35,"readyState"],[63,74,51,45],[63,79,51,50,"socket"],[63,85,51,56],[63,86,51,57,"CLOSING"],[63,93,51,64],[63,95,52,28],[63,101,52,34],[63,105,52,38,"request_js_1"],[63,117,52,50],[63,118,52,51,"WebSocketRequestError"],[63,139,52,72],[63,140,52,73],[64,16,53,32,"url"],[64,19,53,35],[64,21,53,37,"socket"],[64,27,53,43],[64,28,53,44,"url"],[64,31,53,47],[65,16,54,32,"cause"],[65,21,54,37],[65,23,54,39],[65,27,54,43,"request_js_1"],[65,39,54,55],[65,40,54,56,"SocketClosedError"],[65,57,54,73],[65,58,54,74],[66,18,54,76,"url"],[66,21,54,79],[66,23,54,81,"socket"],[66,29,54,87],[66,30,54,88,"url"],[67,16,54,92],[67,17,54,93],[68,14,55,28],[68,15,55,29],[68,16,55,30],[69,14,56,24],[69,20,56,30,"body"],[69,24,56,34],[69,27,56,37],[70,16,57,28,"jsonrpc"],[70,23,57,35],[70,25,57,37],[70,30,57,42],[71,16,58,28,"id"],[71,18,58,30],[71,20,58,32],[71,24,58,36],[72,16,59,28,"method"],[72,22,59,34],[72,24,59,36],[72,37,59,49],[73,16,60,28,"params"],[73,22,60,34],[73,24,60,36],[74,14,61,24],[74,15,61,25],[75,14,62,24,"socket"],[75,20,62,30],[75,21,62,31,"send"],[75,25,62,35],[75,26,62,36,"JSON"],[75,30,62,40],[75,31,62,41,"stringify"],[75,40,62,50],[75,41,62,51,"body"],[75,45,62,55],[75,46,62,56],[75,47,62,57],[76,12,63,20],[76,13,63,21],[76,14,64,20],[76,21,64,27,"error"],[76,26,64,32],[76,28,64,34],[77,14,65,24,"onError"],[77,21,65,31],[77,22,65,32,"error"],[77,27,65,37],[77,28,65,38],[78,12,66,20],[79,10,67,16],[79,11,67,17],[80,10,68,16,"request"],[80,17,68,23,"request"],[80,18,68,24],[81,12,68,26,"body"],[82,10,68,31],[82,11,68,32],[82,13,68,34],[83,12,69,20],[83,16,69,24,"socket"],[83,22,69,30],[83,23,69,31,"readyState"],[83,33,69,41],[83,38,69,46,"socket"],[83,44,69,52],[83,45,69,53,"CLOSED"],[83,51,69,59],[83,55,70,24,"socket"],[83,61,70,30],[83,62,70,31,"readyState"],[83,72,70,41],[83,77,70,46,"socket"],[83,83,70,52],[83,84,70,53,"CLOSING"],[83,91,70,60],[83,93,71,24],[83,99,71,30],[83,103,71,34,"request_js_1"],[83,115,71,46],[83,116,71,47,"WebSocketRequestError"],[83,137,71,68],[83,138,71,69],[84,14,72,28,"body"],[84,18,72,32],[85,14,73,28,"url"],[85,17,73,31],[85,19,73,33,"socket"],[85,25,73,39],[85,26,73,40,"url"],[85,29,73,43],[86,14,74,28,"cause"],[86,19,74,33],[86,21,74,35],[86,25,74,39,"request_js_1"],[86,37,74,51],[86,38,74,52,"SocketClosedError"],[86,55,74,69],[86,56,74,70],[87,16,74,72,"url"],[87,19,74,75],[87,21,74,77,"socket"],[87,27,74,83],[87,28,74,84,"url"],[88,14,74,88],[88,15,74,89],[89,12,75,24],[89,13,75,25],[89,14,75,26],[90,12,76,20],[90,19,76,27,"socket"],[90,25,76,33],[90,26,76,34,"send"],[90,30,76,38],[90,31,76,39,"JSON"],[90,35,76,43],[90,36,76,44,"stringify"],[90,45,76,53],[90,46,76,54,"body"],[90,50,76,58],[90,51,76,59],[90,52,76,60],[91,10,77,16],[92,8,78,12],[92,9,78,13],[92,10,78,14],[93,6,79,8],[93,7,79,9],[94,6,80,8,"keepAlive"],[94,15,80,17],[95,6,81,8,"reconnect"],[95,15,81,17],[96,6,82,8,"url"],[97,4,83,4],[97,5,83,5],[97,6,83,6],[98,2,84,0],[99,0,84,1],[99,3]],"functionMap":{"names":["<global>","getWebSocketRpcClient","getSocket","Promise.resolve.then$argument_0","Promise.resolve.then.then$argument_0","onClose_","onMessage","Promise$argument_0","Object.assign$argument_1.close","Object.assign$argument_1.ping","Object.assign$argument_1.request"],"mappings":"AAA;ACK;QCG;2DCC,sBD,OE,4BF;YGE;aHM;YIC;aJU;kCKM;iBLK;gBMI;iBNG;gBOC;iBPmB;gBQC;iBRS;SDE;CDK"},"hasCjsExports":true},"type":"js/module"}]}