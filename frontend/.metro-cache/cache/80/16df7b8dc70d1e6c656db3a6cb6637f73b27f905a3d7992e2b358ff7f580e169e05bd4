{"dependencies":[{"name":"../../errors/request.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":74,"index":74}}],"key":"2pE/btc+6/9ceuRiPNwUYrtm86Y=","exportNames":["*"],"imports":1}},{"name":"../promise/withTimeout.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":75},"end":{"line":2,"column":57,"index":132}}],"key":"R0pXVlZ6xmiOVM86DCOsnzL2IWE=","exportNames":["*"],"imports":1}},{"name":"../stringify.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":133},"end":{"line":3,"column":44,"index":177}}],"key":"2zgFGs9gb8CDQZBLm+ivBNJ2Ky0=","exportNames":["*"],"imports":1}},{"name":"./id.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":4,"column":0,"index":178},"end":{"line":4,"column":34,"index":212}}],"key":"XzJUTA7q3576wrp3vEEP4WANxL4=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n  exports.getHttpRpcClient = getHttpRpcClient;\n  var _errorsRequestJs = require(_dependencyMap[0], \"../../errors/request.js\");\n  var _promiseWithTimeoutJs = require(_dependencyMap[1], \"../promise/withTimeout.js\");\n  var _stringifyJs = require(_dependencyMap[2], \"../stringify.js\");\n  var _idJs = require(_dependencyMap[3], \"./id.js\");\n  function getHttpRpcClient(url, options = {}) {\n    return {\n      async request(params) {\n        const {\n          body,\n          fetchFn = options.fetchFn ?? fetch,\n          onRequest = options.onRequest,\n          onResponse = options.onResponse,\n          timeout = options.timeout ?? 10_000\n        } = params;\n        const fetchOptions = {\n          ...(options.fetchOptions ?? {}),\n          ...(params.fetchOptions ?? {})\n        };\n        const {\n          headers,\n          method,\n          signal: signal_\n        } = fetchOptions;\n        try {\n          const response = await (0, _promiseWithTimeoutJs.withTimeout)(async ({\n            signal\n          }) => {\n            const init = {\n              ...fetchOptions,\n              body: Array.isArray(body) ? (0, _stringifyJs.stringify)(body.map(body => ({\n                jsonrpc: '2.0',\n                id: body.id ?? _idJs.idCache.take(),\n                ...body\n              }))) : (0, _stringifyJs.stringify)({\n                jsonrpc: '2.0',\n                id: body.id ?? _idJs.idCache.take(),\n                ...body\n              }),\n              headers: {\n                'Content-Type': 'application/json',\n                ...headers\n              },\n              method: method || 'POST',\n              signal: signal_ || (timeout > 0 ? signal : null)\n            };\n            const request = new Request(url, init);\n            const args = (await onRequest?.(request, init)) ?? {\n              ...init,\n              url\n            };\n            const response = await fetchFn(args.url ?? url, args);\n            return response;\n          }, {\n            errorInstance: new _errorsRequestJs.TimeoutError({\n              body,\n              url\n            }),\n            timeout,\n            signal: true\n          });\n          if (onResponse) await onResponse(response);\n          let data;\n          if (response.headers.get('Content-Type')?.startsWith('application/json')) data = await response.json();else {\n            data = await response.text();\n            try {\n              data = JSON.parse(data || '{}');\n            } catch (err) {\n              if (response.ok) throw err;\n              data = {\n                error: data\n              };\n            }\n          }\n          if (!response.ok) {\n            throw new _errorsRequestJs.HttpRequestError({\n              body,\n              details: (0, _stringifyJs.stringify)(data.error) || response.statusText,\n              headers: response.headers,\n              status: response.status,\n              url\n            });\n          }\n          return data;\n        } catch (err) {\n          if (err instanceof _errorsRequestJs.HttpRequestError) throw err;\n          if (err instanceof _errorsRequestJs.TimeoutError) throw err;\n          throw new _errorsRequestJs.HttpRequestError({\n            body,\n            cause: err,\n            url\n          });\n        }\n      }\n    };\n  }\n});","lineCount":103,"map":[[7,2,5,0,"exports"],[7,9,5,0],[7,10,5,0,"getHttpRpcClient"],[7,26,5,0],[7,29,5,0,"getHttpRpcClient"],[7,45,5,0],[8,2,1,0],[8,6,1,0,"_errorsRequestJs"],[8,22,1,0],[8,25,1,0,"require"],[8,32,1,0],[8,33,1,0,"_dependencyMap"],[8,47,1,0],[9,2,2,0],[9,6,2,0,"_promiseWithTimeoutJs"],[9,27,2,0],[9,30,2,0,"require"],[9,37,2,0],[9,38,2,0,"_dependencyMap"],[9,52,2,0],[10,2,3,0],[10,6,3,0,"_stringifyJs"],[10,18,3,0],[10,21,3,0,"require"],[10,28,3,0],[10,29,3,0,"_dependencyMap"],[10,43,3,0],[11,2,4,0],[11,6,4,0,"_idJs"],[11,11,4,0],[11,14,4,0,"require"],[11,21,4,0],[11,22,4,0,"_dependencyMap"],[11,36,4,0],[12,2,5,7],[12,11,5,16,"getHttpRpcClient"],[12,27,5,32,"getHttpRpcClient"],[12,28,5,33,"url"],[12,31,5,36],[12,33,5,38,"options"],[12,40,5,45],[12,43,5,48],[12,44,5,49],[12,45,5,50],[12,47,5,52],[13,4,6,4],[13,11,6,11],[14,6,7,8],[14,12,7,14,"request"],[14,19,7,21,"request"],[14,20,7,22,"params"],[14,26,7,28],[14,28,7,30],[15,8,8,12],[15,14,8,18],[16,10,8,20,"body"],[16,14,8,24],[17,10,8,26,"fetchFn"],[17,17,8,33],[17,20,8,36,"options"],[17,27,8,43],[17,28,8,44,"fetchFn"],[17,35,8,51],[17,39,8,55,"fetch"],[17,44,8,60],[18,10,8,62,"onRequest"],[18,19,8,71],[18,22,8,74,"options"],[18,29,8,81],[18,30,8,82,"onRequest"],[18,39,8,91],[19,10,8,93,"onResponse"],[19,20,8,103],[19,23,8,106,"options"],[19,30,8,113],[19,31,8,114,"onResponse"],[19,41,8,124],[20,10,8,126,"timeout"],[20,17,8,133],[20,20,8,136,"options"],[20,27,8,143],[20,28,8,144,"timeout"],[20,35,8,151],[20,39,8,155],[21,8,8,163],[21,9,8,164],[21,12,8,167,"params"],[21,18,8,173],[22,8,9,12],[22,14,9,18,"fetchOptions"],[22,26,9,30],[22,29,9,33],[23,10,10,16],[23,14,10,20,"options"],[23,21,10,27],[23,22,10,28,"fetchOptions"],[23,34,10,40],[23,38,10,44],[23,39,10,45],[23,40,10,46],[23,41,10,47],[24,10,11,16],[24,14,11,20,"params"],[24,20,11,26],[24,21,11,27,"fetchOptions"],[24,33,11,39],[24,37,11,43],[24,38,11,44],[24,39,11,45],[25,8,12,12],[25,9,12,13],[26,8,13,12],[26,14,13,18],[27,10,13,20,"headers"],[27,17,13,27],[28,10,13,29,"method"],[28,16,13,35],[29,10,13,37,"signal"],[29,16,13,43],[29,18,13,45,"signal_"],[30,8,13,53],[30,9,13,54],[30,12,13,57,"fetchOptions"],[30,24,13,69],[31,8,14,12],[31,12,14,16],[32,10,15,16],[32,16,15,22,"response"],[32,24,15,30],[32,27,15,33],[32,33,15,39],[32,37,15,39,"withTimeout"],[32,58,15,50],[32,59,15,50,"withTimeout"],[32,70,15,50],[32,72,15,51],[32,79,15,58],[33,12,15,60,"signal"],[34,10,15,67],[34,11,15,68],[34,16,15,73],[35,12,16,20],[35,18,16,26,"init"],[35,22,16,30],[35,25,16,33],[36,14,17,24],[36,17,17,27,"fetchOptions"],[36,29,17,39],[37,14,18,24,"body"],[37,18,18,28],[37,20,18,30,"Array"],[37,25,18,35],[37,26,18,36,"isArray"],[37,33,18,43],[37,34,18,44,"body"],[37,38,18,48],[37,39,18,49],[37,42,19,30],[37,46,19,30,"stringify"],[37,58,19,39],[37,59,19,39,"stringify"],[37,68,19,39],[37,70,19,40,"body"],[37,74,19,44],[37,75,19,45,"map"],[37,78,19,48],[37,79,19,50,"body"],[37,83,19,54],[37,88,19,60],[38,16,20,32,"jsonrpc"],[38,23,20,39],[38,25,20,41],[38,30,20,46],[39,16,21,32,"id"],[39,18,21,34],[39,20,21,36,"body"],[39,24,21,40],[39,25,21,41,"id"],[39,27,21,43],[39,31,21,47,"idCache"],[39,36,21,54],[39,37,21,54,"idCache"],[39,44,21,54],[39,45,21,55,"take"],[39,49,21,59],[39,50,21,60],[39,51,21,61],[40,16,22,32],[40,19,22,35,"body"],[41,14,23,28],[41,15,23,29],[41,16,23,30],[41,17,23,31],[41,18,23,32],[41,21,24,30],[41,25,24,30,"stringify"],[41,37,24,39],[41,38,24,39,"stringify"],[41,47,24,39],[41,49,24,40],[42,16,25,32,"jsonrpc"],[42,23,25,39],[42,25,25,41],[42,30,25,46],[43,16,26,32,"id"],[43,18,26,34],[43,20,26,36,"body"],[43,24,26,40],[43,25,26,41,"id"],[43,27,26,43],[43,31,26,47,"idCache"],[43,36,26,54],[43,37,26,54,"idCache"],[43,44,26,54],[43,45,26,55,"take"],[43,49,26,59],[43,50,26,60],[43,51,26,61],[44,16,27,32],[44,19,27,35,"body"],[45,14,28,28],[45,15,28,29],[45,16,28,30],[46,14,29,24,"headers"],[46,21,29,31],[46,23,29,33],[47,16,30,28],[47,30,30,42],[47,32,30,44],[47,50,30,62],[48,16,31,28],[48,19,31,31,"headers"],[49,14,32,24],[49,15,32,25],[50,14,33,24,"method"],[50,20,33,30],[50,22,33,32,"method"],[50,28,33,38],[50,32,33,42],[50,38,33,48],[51,14,34,24,"signal"],[51,20,34,30],[51,22,34,32,"signal_"],[51,29,34,39],[51,34,34,44,"timeout"],[51,41,34,51],[51,44,34,54],[51,45,34,55],[51,48,34,58,"signal"],[51,54,34,64],[51,57,34,67],[51,61,34,71],[52,12,35,20],[52,13,35,21],[53,12,36,20],[53,18,36,26,"request"],[53,25,36,33],[53,28,36,36],[53,32,36,40,"Request"],[53,39,36,47],[53,40,36,48,"url"],[53,43,36,51],[53,45,36,53,"init"],[53,49,36,57],[53,50,36,58],[54,12,37,20],[54,18,37,26,"args"],[54,22,37,30],[54,25,37,33],[54,26,37,34],[54,32,37,40,"onRequest"],[54,41,37,49],[54,44,37,52,"request"],[54,51,37,59],[54,53,37,61,"init"],[54,57,37,65],[54,58,37,66],[54,63,37,71],[55,14,37,73],[55,17,37,76,"init"],[55,21,37,80],[56,14,37,82,"url"],[57,12,37,86],[57,13,37,87],[58,12,38,20],[58,18,38,26,"response"],[58,26,38,34],[58,29,38,37],[58,35,38,43,"fetchFn"],[58,42,38,50],[58,43,38,51,"args"],[58,47,38,55],[58,48,38,56,"url"],[58,51,38,59],[58,55,38,63,"url"],[58,58,38,66],[58,60,38,68,"args"],[58,64,38,72],[58,65,38,73],[59,12,39,20],[59,19,39,27,"response"],[59,27,39,35],[60,10,40,16],[60,11,40,17],[60,13,40,19],[61,12,41,20,"errorInstance"],[61,25,41,33],[61,27,41,35],[61,31,41,39,"TimeoutError"],[61,47,41,51],[61,48,41,51,"TimeoutError"],[61,60,41,51],[61,61,41,52],[62,14,41,54,"body"],[62,18,41,58],[63,14,41,60,"url"],[64,12,41,64],[64,13,41,65],[64,14,41,66],[65,12,42,20,"timeout"],[65,19,42,27],[66,12,43,20,"signal"],[66,18,43,26],[66,20,43,28],[67,10,44,16],[67,11,44,17],[67,12,44,18],[68,10,45,16],[68,14,45,20,"onResponse"],[68,24,45,30],[68,26,46,20],[68,32,46,26,"onResponse"],[68,42,46,36],[68,43,46,37,"response"],[68,51,46,45],[68,52,46,46],[69,10,47,16],[69,14,47,20,"data"],[69,18,47,24],[70,10,48,16],[70,14,48,20,"response"],[70,22,48,28],[70,23,48,29,"headers"],[70,30,48,36],[70,31,48,37,"get"],[70,34,48,40],[70,35,48,41],[70,49,48,55],[70,50,48,56],[70,52,48,58,"startsWith"],[70,62,48,68],[70,63,48,69],[70,81,48,87],[70,82,48,88],[70,84,49,20,"data"],[70,88,49,24],[70,91,49,27],[70,97,49,33,"response"],[70,105,49,41],[70,106,49,42,"json"],[70,110,49,46],[70,111,49,47],[70,112,49,48],[70,113,49,49],[70,118,50,21],[71,12,51,20,"data"],[71,16,51,24],[71,19,51,27],[71,25,51,33,"response"],[71,33,51,41],[71,34,51,42,"text"],[71,38,51,46],[71,39,51,47],[71,40,51,48],[72,12,52,20],[72,16,52,24],[73,14,53,24,"data"],[73,18,53,28],[73,21,53,31,"JSON"],[73,25,53,35],[73,26,53,36,"parse"],[73,31,53,41],[73,32,53,42,"data"],[73,36,53,46],[73,40,53,50],[73,44,53,54],[73,45,53,55],[74,12,54,20],[74,13,54,21],[74,14,55,20],[74,21,55,27,"err"],[74,24,55,30],[74,26,55,32],[75,14,56,24],[75,18,56,28,"response"],[75,26,56,36],[75,27,56,37,"ok"],[75,29,56,39],[75,31,57,28],[75,37,57,34,"err"],[75,40,57,37],[76,14,58,24,"data"],[76,18,58,28],[76,21,58,31],[77,16,58,33,"error"],[77,21,58,38],[77,23,58,40,"data"],[78,14,58,45],[78,15,58,46],[79,12,59,20],[80,10,60,16],[81,10,61,16],[81,14,61,20],[81,15,61,21,"response"],[81,23,61,29],[81,24,61,30,"ok"],[81,26,61,32],[81,28,61,34],[82,12,62,20],[82,18,62,26],[82,22,62,30,"HttpRequestError"],[82,38,62,46],[82,39,62,46,"HttpRequestError"],[82,55,62,46],[82,56,62,47],[83,14,63,24,"body"],[83,18,63,28],[84,14,64,24,"details"],[84,21,64,31],[84,23,64,33],[84,27,64,33,"stringify"],[84,39,64,42],[84,40,64,42,"stringify"],[84,49,64,42],[84,51,64,43,"data"],[84,55,64,47],[84,56,64,48,"error"],[84,61,64,53],[84,62,64,54],[84,66,64,58,"response"],[84,74,64,66],[84,75,64,67,"statusText"],[84,85,64,77],[85,14,65,24,"headers"],[85,21,65,31],[85,23,65,33,"response"],[85,31,65,41],[85,32,65,42,"headers"],[85,39,65,49],[86,14,66,24,"status"],[86,20,66,30],[86,22,66,32,"response"],[86,30,66,40],[86,31,66,41,"status"],[86,37,66,47],[87,14,67,24,"url"],[88,12,68,20],[88,13,68,21],[88,14,68,22],[89,10,69,16],[90,10,70,16],[90,17,70,23,"data"],[90,21,70,27],[91,8,71,12],[91,9,71,13],[91,10,72,12],[91,17,72,19,"err"],[91,20,72,22],[91,22,72,24],[92,10,73,16],[92,14,73,20,"err"],[92,17,73,23],[92,29,73,35,"HttpRequestError"],[92,45,73,51],[92,46,73,51,"HttpRequestError"],[92,62,73,51],[92,64,74,20],[92,70,74,26,"err"],[92,73,74,29],[93,10,75,16],[93,14,75,20,"err"],[93,17,75,23],[93,29,75,35,"TimeoutError"],[93,45,75,47],[93,46,75,47,"TimeoutError"],[93,58,75,47],[93,60,76,20],[93,66,76,26,"err"],[93,69,76,29],[94,10,77,16],[94,16,77,22],[94,20,77,26,"HttpRequestError"],[94,36,77,42],[94,37,77,42,"HttpRequestError"],[94,53,77,42],[94,54,77,43],[95,12,78,20,"body"],[95,16,78,24],[96,12,79,20,"cause"],[96,17,79,25],[96,19,79,27,"err"],[96,22,79,30],[97,12,80,20,"url"],[98,10,81,16],[98,11,81,17],[98,12,81,18],[99,8,82,12],[100,6,83,8],[101,4,84,4],[101,5,84,5],[102,2,85,0],[103,0,85,1],[103,3]],"functionMap":{"names":["<global>","getHttpRpcClient","request","withTimeout$argument_0","body.map$argument_0"],"mappings":"AAA;OCI;QCE;mDCQ;iDCI;8BDI;iBDiB;SD2C;CDE"},"hasCjsExports":false},"type":"js/module"}]}