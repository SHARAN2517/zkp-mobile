{"dependencies":[{"name":"../../utils/encoding/fromHex.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":4,"column":21,"index":143},"end":{"line":4,"column":63,"index":185}}],"key":"T6LoMSTzqzYJuDqc58ktEbJCK9Q=","exportNames":["*"],"imports":1}},{"name":"../../utils/getAction.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":5,"column":23,"index":210},"end":{"line":5,"column":58,"index":245}}],"key":"d685V9n1u7O1oRJ2ZbnkuLpcslA=","exportNames":["*"],"imports":1}},{"name":"../../utils/observe.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":6,"column":21,"index":268},"end":{"line":6,"column":54,"index":301}}],"key":"NlEDsinWPPoPV3uHdXDCPvBuxx8=","exportNames":["*"],"imports":1}},{"name":"../../utils/poll.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":7,"column":18,"index":321},"end":{"line":7,"column":48,"index":351}}],"key":"VGDCY0JetsesgNJKn2v/Q97mlvo=","exportNames":["*"],"imports":1}},{"name":"../../utils/stringify.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":8,"column":23,"index":376},"end":{"line":8,"column":58,"index":411}}],"key":"o4d2CDgTn514XnsqOYcryKEOe1A=","exportNames":["*"],"imports":1}},{"name":"./getBlockNumber.js","data":{"asyncType":null,"isESMImport":false,"locs":[{"start":{"line":9,"column":28,"index":441},"end":{"line":9,"column":58,"index":471}}],"key":"C0Y7h8azvfmBC33QpzHPTvqjITU=","exportNames":["*"],"imports":1}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  \"use strict\";\n\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.watchBlockNumber = watchBlockNumber;\n  const fromHex_js_1 = require(_dependencyMap[0], \"../../utils/encoding/fromHex.js\");\n  const getAction_js_1 = require(_dependencyMap[1], \"../../utils/getAction.js\");\n  const observe_js_1 = require(_dependencyMap[2], \"../../utils/observe.js\");\n  const poll_js_1 = require(_dependencyMap[3], \"../../utils/poll.js\");\n  const stringify_js_1 = require(_dependencyMap[4], \"../../utils/stringify.js\");\n  const getBlockNumber_js_1 = require(_dependencyMap[5], \"./getBlockNumber.js\");\n  function watchBlockNumber(client, {\n    emitOnBegin = false,\n    emitMissed = false,\n    onBlockNumber,\n    onError,\n    poll: poll_,\n    pollingInterval = client.pollingInterval\n  }) {\n    const enablePolling = (() => {\n      if (typeof poll_ !== 'undefined') return poll_;\n      if (client.transport.type === 'webSocket' || client.transport.type === 'ipc') return false;\n      if (client.transport.type === 'fallback' && (client.transport.transports[0].config.type === 'webSocket' || client.transport.transports[0].config.type === 'ipc')) return false;\n      return true;\n    })();\n    let prevBlockNumber;\n    const pollBlockNumber = () => {\n      const observerId = (0, stringify_js_1.stringify)(['watchBlockNumber', client.uid, emitOnBegin, emitMissed, pollingInterval]);\n      return (0, observe_js_1.observe)(observerId, {\n        onBlockNumber,\n        onError\n      }, emit => (0, poll_js_1.poll)(async () => {\n        try {\n          const blockNumber = await (0, getAction_js_1.getAction)(client, getBlockNumber_js_1.getBlockNumber, 'getBlockNumber')({\n            cacheTime: 0\n          });\n          if (prevBlockNumber !== undefined) {\n            if (blockNumber === prevBlockNumber) return;\n            if (blockNumber - prevBlockNumber > 1 && emitMissed) {\n              for (let i = prevBlockNumber + 1n; i < blockNumber; i++) {\n                emit.onBlockNumber(i, prevBlockNumber);\n                prevBlockNumber = i;\n              }\n            }\n          }\n          if (prevBlockNumber === undefined || blockNumber > prevBlockNumber) {\n            emit.onBlockNumber(blockNumber, prevBlockNumber);\n            prevBlockNumber = blockNumber;\n          }\n        } catch (err) {\n          emit.onError?.(err);\n        }\n      }, {\n        emitOnBegin,\n        interval: pollingInterval\n      }));\n    };\n    const subscribeBlockNumber = () => {\n      const observerId = (0, stringify_js_1.stringify)(['watchBlockNumber', client.uid, emitOnBegin, emitMissed]);\n      return (0, observe_js_1.observe)(observerId, {\n        onBlockNumber,\n        onError\n      }, emit => {\n        let active = true;\n        let unsubscribe = () => active = false;\n        (async () => {\n          try {\n            const transport = (() => {\n              if (client.transport.type === 'fallback') {\n                const transport = client.transport.transports.find(transport => transport.config.type === 'webSocket' || transport.config.type === 'ipc');\n                if (!transport) return client.transport;\n                return transport.value;\n              }\n              return client.transport;\n            })();\n            const {\n              unsubscribe: unsubscribe_\n            } = await transport.subscribe({\n              params: ['newHeads'],\n              onData(data) {\n                if (!active) return;\n                const blockNumber = (0, fromHex_js_1.hexToBigInt)(data.result?.number);\n                emit.onBlockNumber(blockNumber, prevBlockNumber);\n                prevBlockNumber = blockNumber;\n              },\n              onError(error) {\n                emit.onError?.(error);\n              }\n            });\n            unsubscribe = unsubscribe_;\n            if (!active) unsubscribe();\n          } catch (err) {\n            onError?.(err);\n          }\n        })();\n        return () => unsubscribe();\n      });\n    };\n    return enablePolling ? pollBlockNumber() : subscribeBlockNumber();\n  }\n});","lineCount":103,"map":[[2,2,1,0],[2,14,1,12],[4,2,2,0,"Object"],[4,8,2,6],[4,9,2,7,"defineProperty"],[4,23,2,21],[4,24,2,22,"exports"],[4,31,2,29],[4,33,2,31],[4,45,2,43],[4,47,2,45],[5,4,2,47,"value"],[5,9,2,52],[5,11,2,54],[6,2,2,59],[6,3,2,60],[6,4,2,61],[7,2,3,0,"exports"],[7,9,3,7],[7,10,3,8,"watchBlockNumber"],[7,26,3,24],[7,29,3,27,"watchBlockNumber"],[7,45,3,43],[8,2,4,0],[8,8,4,6,"fromHex_js_1"],[8,20,4,18],[8,23,4,21,"require"],[8,30,4,28],[8,31,4,28,"_dependencyMap"],[8,45,4,28],[8,83,4,62],[8,84,4,63],[9,2,5,0],[9,8,5,6,"getAction_js_1"],[9,22,5,20],[9,25,5,23,"require"],[9,32,5,30],[9,33,5,30,"_dependencyMap"],[9,47,5,30],[9,78,5,57],[9,79,5,58],[10,2,6,0],[10,8,6,6,"observe_js_1"],[10,20,6,18],[10,23,6,21,"require"],[10,30,6,28],[10,31,6,28,"_dependencyMap"],[10,45,6,28],[10,74,6,53],[10,75,6,54],[11,2,7,0],[11,8,7,6,"poll_js_1"],[11,17,7,15],[11,20,7,18,"require"],[11,27,7,25],[11,28,7,25,"_dependencyMap"],[11,42,7,25],[11,68,7,47],[11,69,7,48],[12,2,8,0],[12,8,8,6,"stringify_js_1"],[12,22,8,20],[12,25,8,23,"require"],[12,32,8,30],[12,33,8,30,"_dependencyMap"],[12,47,8,30],[12,78,8,57],[12,79,8,58],[13,2,9,0],[13,8,9,6,"getBlockNumber_js_1"],[13,27,9,25],[13,30,9,28,"require"],[13,37,9,35],[13,38,9,35,"_dependencyMap"],[13,52,9,35],[13,78,9,57],[13,79,9,58],[14,2,10,0],[14,11,10,9,"watchBlockNumber"],[14,27,10,25,"watchBlockNumber"],[14,28,10,26,"client"],[14,34,10,32],[14,36,10,34],[15,4,10,36,"emitOnBegin"],[15,15,10,47],[15,18,10,50],[15,23,10,55],[16,4,10,57,"emitMissed"],[16,14,10,67],[16,17,10,70],[16,22,10,75],[17,4,10,77,"onBlockNumber"],[17,17,10,90],[18,4,10,92,"onError"],[18,11,10,99],[19,4,10,101,"poll"],[19,8,10,105],[19,10,10,107,"poll_"],[19,15,10,112],[20,4,10,114,"pollingInterval"],[20,19,10,129],[20,22,10,132,"client"],[20,28,10,138],[20,29,10,139,"pollingInterval"],[21,2,10,156],[21,3,10,157],[21,5,10,159],[22,4,11,4],[22,10,11,10,"enablePolling"],[22,23,11,23],[22,26,11,26],[22,27,11,27],[22,33,11,33],[23,6,12,8],[23,10,12,12],[23,17,12,19,"poll_"],[23,22,12,24],[23,27,12,29],[23,38,12,40],[23,40,13,12],[23,47,13,19,"poll_"],[23,52,13,24],[24,6,14,8],[24,10,14,12,"client"],[24,16,14,18],[24,17,14,19,"transport"],[24,26,14,28],[24,27,14,29,"type"],[24,31,14,33],[24,36,14,38],[24,47,14,49],[24,51,15,12,"client"],[24,57,15,18],[24,58,15,19,"transport"],[24,67,15,28],[24,68,15,29,"type"],[24,72,15,33],[24,77,15,38],[24,82,15,43],[24,84,16,12],[24,91,16,19],[24,96,16,24],[25,6,17,8],[25,10,17,12,"client"],[25,16,17,18],[25,17,17,19,"transport"],[25,26,17,28],[25,27,17,29,"type"],[25,31,17,33],[25,36,17,38],[25,46,17,48],[25,51,18,13,"client"],[25,57,18,19],[25,58,18,20,"transport"],[25,67,18,29],[25,68,18,30,"transports"],[25,78,18,40],[25,79,18,41],[25,80,18,42],[25,81,18,43],[25,82,18,44,"config"],[25,88,18,50],[25,89,18,51,"type"],[25,93,18,55],[25,98,18,60],[25,109,18,71],[25,113,19,16,"client"],[25,119,19,22],[25,120,19,23,"transport"],[25,129,19,32],[25,130,19,33,"transports"],[25,140,19,43],[25,141,19,44],[25,142,19,45],[25,143,19,46],[25,144,19,47,"config"],[25,150,19,53],[25,151,19,54,"type"],[25,155,19,58],[25,160,19,63],[25,165,19,68],[25,166,19,69],[25,168,20,12],[25,175,20,19],[25,180,20,24],[26,6,21,8],[26,13,21,15],[26,17,21,19],[27,4,22,4],[27,5,22,5],[27,7,22,7],[27,8,22,8],[28,4,23,4],[28,8,23,8,"prevBlockNumber"],[28,23,23,23],[29,4,24,4],[29,10,24,10,"pollBlockNumber"],[29,25,24,25],[29,28,24,28,"pollBlockNumber"],[29,29,24,28],[29,34,24,34],[30,6,25,8],[30,12,25,14,"observerId"],[30,22,25,24],[30,25,25,27],[30,26,25,28],[30,27,25,29],[30,29,25,31,"stringify_js_1"],[30,43,25,45],[30,44,25,46,"stringify"],[30,53,25,55],[30,55,25,57],[30,56,26,12],[30,74,26,30],[30,76,27,12,"client"],[30,82,27,18],[30,83,27,19,"uid"],[30,86,27,22],[30,88,28,12,"emitOnBegin"],[30,99,28,23],[30,101,29,12,"emitMissed"],[30,111,29,22],[30,113,30,12,"pollingInterval"],[30,128,30,27],[30,129,31,9],[30,130,31,10],[31,6,32,8],[31,13,32,15],[31,14,32,16],[31,15,32,17],[31,17,32,19,"observe_js_1"],[31,29,32,31],[31,30,32,32,"observe"],[31,37,32,39],[31,39,32,41,"observerId"],[31,49,32,51],[31,51,32,53],[32,8,32,55,"onBlockNumber"],[32,21,32,68],[33,8,32,70,"onError"],[34,6,32,78],[34,7,32,79],[34,9,32,82,"emit"],[34,13,32,86],[34,17,32,91],[34,18,32,92],[34,19,32,93],[34,21,32,95,"poll_js_1"],[34,30,32,104],[34,31,32,105,"poll"],[34,35,32,109],[34,37,32,111],[34,49,32,123],[35,8,33,12],[35,12,33,16],[36,10,34,16],[36,16,34,22,"blockNumber"],[36,27,34,33],[36,30,34,36],[36,36,34,42],[36,37,34,43],[36,38,34,44],[36,40,34,46,"getAction_js_1"],[36,54,34,60],[36,55,34,61,"getAction"],[36,64,34,70],[36,66,34,72,"client"],[36,72,34,78],[36,74,34,80,"getBlockNumber_js_1"],[36,93,34,99],[36,94,34,100,"getBlockNumber"],[36,108,34,114],[36,110,34,116],[36,126,34,132],[36,127,34,133],[36,128,34,134],[37,12,34,136,"cacheTime"],[37,21,34,145],[37,23,34,147],[38,10,34,149],[38,11,34,150],[38,12,34,151],[39,10,35,16],[39,14,35,20,"prevBlockNumber"],[39,29,35,35],[39,34,35,40,"undefined"],[39,43,35,49],[39,45,35,51],[40,12,36,20],[40,16,36,24,"blockNumber"],[40,27,36,35],[40,32,36,40,"prevBlockNumber"],[40,47,36,55],[40,49,37,24],[41,12,38,20],[41,16,38,24,"blockNumber"],[41,27,38,35],[41,30,38,38,"prevBlockNumber"],[41,45,38,53],[41,48,38,56],[41,49,38,57],[41,53,38,61,"emitMissed"],[41,63,38,71],[41,65,38,73],[42,14,39,24],[42,19,39,29],[42,23,39,33,"i"],[42,24,39,34],[42,27,39,37,"prevBlockNumber"],[42,42,39,52],[42,45,39,55],[42,47,39,57],[42,49,39,59,"i"],[42,50,39,60],[42,53,39,63,"blockNumber"],[42,64,39,74],[42,66,39,76,"i"],[42,67,39,77],[42,69,39,79],[42,71,39,81],[43,16,40,28,"emit"],[43,20,40,32],[43,21,40,33,"onBlockNumber"],[43,34,40,46],[43,35,40,47,"i"],[43,36,40,48],[43,38,40,50,"prevBlockNumber"],[43,53,40,65],[43,54,40,66],[44,16,41,28,"prevBlockNumber"],[44,31,41,43],[44,34,41,46,"i"],[44,35,41,47],[45,14,42,24],[46,12,43,20],[47,10,44,16],[48,10,45,16],[48,14,45,20,"prevBlockNumber"],[48,29,45,35],[48,34,45,40,"undefined"],[48,43,45,49],[48,47,46,20,"blockNumber"],[48,58,46,31],[48,61,46,34,"prevBlockNumber"],[48,76,46,49],[48,78,46,51],[49,12,47,20,"emit"],[49,16,47,24],[49,17,47,25,"onBlockNumber"],[49,30,47,38],[49,31,47,39,"blockNumber"],[49,42,47,50],[49,44,47,52,"prevBlockNumber"],[49,59,47,67],[49,60,47,68],[50,12,48,20,"prevBlockNumber"],[50,27,48,35],[50,30,48,38,"blockNumber"],[50,41,48,49],[51,10,49,16],[52,8,50,12],[52,9,50,13],[52,10,51,12],[52,17,51,19,"err"],[52,20,51,22],[52,22,51,24],[53,10,52,16,"emit"],[53,14,52,20],[53,15,52,21,"onError"],[53,22,52,28],[53,25,52,31,"err"],[53,28,52,34],[53,29,52,35],[54,8,53,12],[55,6,54,8],[55,7,54,9],[55,9,54,11],[56,8,55,12,"emitOnBegin"],[56,19,55,23],[57,8,56,12,"interval"],[57,16,56,20],[57,18,56,22,"pollingInterval"],[58,6,57,8],[58,7,57,9],[58,8,57,10],[58,9,57,11],[59,4,58,4],[59,5,58,5],[60,4,59,4],[60,10,59,10,"subscribeBlockNumber"],[60,30,59,30],[60,33,59,33,"subscribeBlockNumber"],[60,34,59,33],[60,39,59,39],[61,6,60,8],[61,12,60,14,"observerId"],[61,22,60,24],[61,25,60,27],[61,26,60,28],[61,27,60,29],[61,29,60,31,"stringify_js_1"],[61,43,60,45],[61,44,60,46,"stringify"],[61,53,60,55],[61,55,60,57],[61,56,61,12],[61,74,61,30],[61,76,62,12,"client"],[61,82,62,18],[61,83,62,19,"uid"],[61,86,62,22],[61,88,63,12,"emitOnBegin"],[61,99,63,23],[61,101,64,12,"emitMissed"],[61,111,64,22],[61,112,65,9],[61,113,65,10],[62,6,66,8],[62,13,66,15],[62,14,66,16],[62,15,66,17],[62,17,66,19,"observe_js_1"],[62,29,66,31],[62,30,66,32,"observe"],[62,37,66,39],[62,39,66,41,"observerId"],[62,49,66,51],[62,51,66,53],[63,8,66,55,"onBlockNumber"],[63,21,66,68],[64,8,66,70,"onError"],[65,6,66,78],[65,7,66,79],[65,9,66,82,"emit"],[65,13,66,86],[65,17,66,91],[66,8,67,12],[66,12,67,16,"active"],[66,18,67,22],[66,21,67,25],[66,25,67,29],[67,8,68,12],[67,12,68,16,"unsubscribe"],[67,23,68,27],[67,26,68,30,"unsubscribe"],[67,27,68,30],[67,32,68,37,"active"],[67,38,68,43],[67,41,68,46],[67,46,68,52],[68,8,69,12],[68,9,69,13],[68,21,69,25],[69,10,70,16],[69,14,70,20],[70,12,71,20],[70,18,71,26,"transport"],[70,27,71,35],[70,30,71,38],[70,31,71,39],[70,37,71,45],[71,14,72,24],[71,18,72,28,"client"],[71,24,72,34],[71,25,72,35,"transport"],[71,34,72,44],[71,35,72,45,"type"],[71,39,72,49],[71,44,72,54],[71,54,72,64],[71,56,72,66],[72,16,73,28],[72,22,73,34,"transport"],[72,31,73,43],[72,34,73,46,"client"],[72,40,73,52],[72,41,73,53,"transport"],[72,50,73,62],[72,51,73,63,"transports"],[72,61,73,73],[72,62,73,74,"find"],[72,66,73,78],[72,67,73,80,"transport"],[72,76,73,89],[72,80,73,94,"transport"],[72,89,73,103],[72,90,73,104,"config"],[72,96,73,110],[72,97,73,111,"type"],[72,101,73,115],[72,106,73,120],[72,117,73,131],[72,121,74,32,"transport"],[72,130,74,41],[72,131,74,42,"config"],[72,137,74,48],[72,138,74,49,"type"],[72,142,74,53],[72,147,74,58],[72,152,74,63],[72,153,74,64],[73,16,75,28],[73,20,75,32],[73,21,75,33,"transport"],[73,30,75,42],[73,32,76,32],[73,39,76,39,"client"],[73,45,76,45],[73,46,76,46,"transport"],[73,55,76,55],[74,16,77,28],[74,23,77,35,"transport"],[74,32,77,44],[74,33,77,45,"value"],[74,38,77,50],[75,14,78,24],[76,14,79,24],[76,21,79,31,"client"],[76,27,79,37],[76,28,79,38,"transport"],[76,37,79,47],[77,12,80,20],[77,13,80,21],[77,15,80,23],[77,16,80,24],[78,12,81,20],[78,18,81,26],[79,14,81,28,"unsubscribe"],[79,25,81,39],[79,27,81,41,"unsubscribe_"],[80,12,81,54],[80,13,81,55],[80,16,81,58],[80,22,81,64,"transport"],[80,31,81,73],[80,32,81,74,"subscribe"],[80,41,81,83],[80,42,81,84],[81,14,82,24,"params"],[81,20,82,30],[81,22,82,32],[81,23,82,33],[81,33,82,43],[81,34,82,44],[82,14,83,24,"onData"],[82,20,83,30,"onData"],[82,21,83,31,"data"],[82,25,83,35],[82,27,83,37],[83,16,84,28],[83,20,84,32],[83,21,84,33,"active"],[83,27,84,39],[83,29,85,32],[84,16,86,28],[84,22,86,34,"blockNumber"],[84,33,86,45],[84,36,86,48],[84,37,86,49],[84,38,86,50],[84,40,86,52,"fromHex_js_1"],[84,52,86,64],[84,53,86,65,"hexToBigInt"],[84,64,86,76],[84,66,86,78,"data"],[84,70,86,82],[84,71,86,83,"result"],[84,77,86,89],[84,79,86,91,"number"],[84,85,86,97],[84,86,86,98],[85,16,87,28,"emit"],[85,20,87,32],[85,21,87,33,"onBlockNumber"],[85,34,87,46],[85,35,87,47,"blockNumber"],[85,46,87,58],[85,48,87,60,"prevBlockNumber"],[85,63,87,75],[85,64,87,76],[86,16,88,28,"prevBlockNumber"],[86,31,88,43],[86,34,88,46,"blockNumber"],[86,45,88,57],[87,14,89,24],[87,15,89,25],[88,14,90,24,"onError"],[88,21,90,31,"onError"],[88,22,90,32,"error"],[88,27,90,37],[88,29,90,39],[89,16,91,28,"emit"],[89,20,91,32],[89,21,91,33,"onError"],[89,28,91,40],[89,31,91,43,"error"],[89,36,91,48],[89,37,91,49],[90,14,92,24],[91,12,93,20],[91,13,93,21],[91,14,93,22],[92,12,94,20,"unsubscribe"],[92,23,94,31],[92,26,94,34,"unsubscribe_"],[92,38,94,46],[93,12,95,20],[93,16,95,24],[93,17,95,25,"active"],[93,23,95,31],[93,25,96,24,"unsubscribe"],[93,36,96,35],[93,37,96,36],[93,38,96,37],[94,10,97,16],[94,11,97,17],[94,12,98,16],[94,19,98,23,"err"],[94,22,98,26],[94,24,98,28],[95,12,99,20,"onError"],[95,19,99,27],[95,22,99,30,"err"],[95,25,99,33],[95,26,99,34],[96,10,100,16],[97,8,101,12],[97,9,101,13],[97,11,101,15],[97,12,101,16],[98,8,102,12],[98,15,102,19],[98,21,102,25,"unsubscribe"],[98,32,102,36],[98,33,102,37],[98,34,102,38],[99,6,103,8],[99,7,103,9],[99,8,103,10],[100,4,104,4],[100,5,104,5],[101,4,105,4],[101,11,105,11,"enablePolling"],[101,24,105,24],[101,27,105,27,"pollBlockNumber"],[101,42,105,42],[101,43,105,43],[101,44,105,44],[101,47,105,47,"subscribeBlockNumber"],[101,67,105,67],[101,68,105,68],[101,69,105,69],[102,2,106,0],[103,0,106,1],[103,3]],"functionMap":{"names":["<global>","watchBlockNumber","<anonymous>","pollBlockNumber","subscribeBlockNumber","unsubscribe","client.transport.transports.find$argument_0","transport.subscribe$argument_0.onData","transport.subscribe$argument_0.onError"],"mappings":"AAA;ACS;2BCC;KDW;4BEE;iFDQ;UCyB;KFC;iCGC;iFFO;8BGE,sBH;+EIK;+DJC;wBKS;yBLM;wBMC;yBNE;SEW;KHC;CDE"},"hasCjsExports":true},"type":"js/module"}]}